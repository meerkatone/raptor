rules:
  - id: raptor.injection.command.taint.python
    message: Untrusted input is passed to command execution. Use safe APIs or sanitise arguments.
    languages: [python]
    severity: CRITICAL
    mode: taint
    pattern-sources:
      - pattern-either:
          - pattern: request.GET[$_]
          - pattern: request.POST[$_]
          - pattern: flask.request.args[$_]
          - pattern: flask.request.form[$_]
          - pattern: input(...)
          - pattern: os.environ[$_]
    pattern-sinks:
      - pattern-either:
          - pattern: subprocess.run($CMD, ..., shell=True, ...)
          - pattern: subprocess.Popen($CMD, ..., shell=True, ...)
          - pattern: os.system($CMD)
          - pattern: os.popen($CMD)
    pattern-sanitizers:
      - pattern: shlex.quote(...)
      - pattern: shlex.join(...)
    metadata:
      cwe: ["CWE-78"]
      owasp_top_10: ["A1:2021-Broken Access Control"]
      tags: ["security", "injection", "command injection", "taint"]
