rules:
  - id: raptor.files.path_traversal.java
    message: Java file construction from potentially unvalidated input; canonicalise and validate inputs.
    languages: [java, kotlin]
    severity: HIGH
    pattern: new File($USERINPUT)
    metadata:
      cwe: ["CWE-22"]

  - id: raptor.files.path_traversal.python
    message: Python open() with concatenated user input; canonicalise and validate inputs.
    languages: [python]
    severity: HIGH
    pattern-either:
      - pattern: open($USERINPUT + "/" + $REST)
      - pattern: open(os.path.join($USERINPUT, $REST))
    metadata:
      cwe: ["CWE-22"]

  - id: raptor.files.path_traversal.js
    message: JavaScript path construction from user input; validate or normalise paths.
    languages: [javascript, typescript]
    severity: HIGH
    pattern-either:
      - pattern: fs.openSync($USERINPUT + "/" + $REST, ...)
      - pattern: fs.readFileSync(path.join($USERINPUT, $REST), ...)
    metadata:
      cwe: ["CWE-22"]

  - id: raptor.files.path_traversal.taint.python
    message: Untrusted data reaches filesystem path operations. Validate or canonicalise the path.
    languages: [python]
    severity: CRITICAL
    mode: taint
    pattern-sources:
      - pattern-either:
          - pattern: request.GET[$_]
          - pattern: request.POST[$_]
          - pattern: flask.request.args[$_]
          - pattern: flask.request.form[$_]
          - pattern: input(...)
    pattern-sinks:
      - pattern-either:
          - pattern: open($PATH)
          - pattern: os.open($PATH, ...)
          - pattern: os.path.join($PATH, ...)
          - pattern: Path($PATH)
    pattern-sanitizers:
      - pattern: os.path.abspath(...)
      - pattern: pathlib.Path(...).resolve()
    metadata:
      cwe: ["CWE-22"]
